{% extends "layout/app.html" %}
{% block head_tail %}
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.13/css/dataTables.bootstrap.min.css">
		  
    <style>
		#result-table_wrapper {
			overflow: auto;
		}

        #result-table_wrapper .table-button {
            float: right;
        }
		
	    #result-table_wrapper .table-button .btn {
	        padding: 4px 12px;
	    }

        #result-table_wrapper .table-filter {
            float: left;
        }

    </style>
{% endblock %}

{% block main_content %}
    <section class="content-header">
        <h1>Daily Summary</h1>
    </section>
    <section class="content">
        <div class="row">
            <div class="col-md-12">
                <div class="box box-primary">
                    <div class="box-body">
                        <div id="charts" style="height: 700px; width: 100%;"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <div class="box box-primary">
                    <div class="box-body">
                        <table id="result-table"
                               class="display responsive no-wrap table table-bordered table-striped table-hover dataTable">
                            <thead>
                            </thead>
                            <tbody>
                            <tr>
                                <td colspan="999">
                                    <div class="text-center">
                                        There are no items in the result table.
                                    </div>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </section>
{% endblock %}

{% block body_tail %}
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.13/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.13/js/dataTables.bootstrap.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.1.0/js/dataTables.buttons.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.1.2/js/buttons.bootstrap.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.1.0/js/buttons.html5.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.27/pdfmake.min.js"></script>
    <script type="text/javascript" src="https://cdn.rawgit.com/bpampuch/pdfmake/0.1.18/build/vfs_fonts.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/2.5.0/jszip.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/echarts/3.5.2/echarts.common.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/echarts/3.5.2/extension/dataTool.min.js"></script>


    {% assets "common_js" %}
        <script src="{{ ASSET_URL }}" type="text/javascript"></script>
    {% endassets %}

    <script type="text/javascript">

        var dom = document.getElementById("charts");
        var myChart = echarts.init(dom, 'shine');

        window.onresize = myChart.resize;
        var option = {
            tooltip: {
                trigger: 'axis'
            },

            legend: {
                data: []
            },
            grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                containLabel: true
            },
            toolbox: {
                show: true,
                orient: 'vertical',
                feature: {
                    dataZoom: {
                        title: {
                            zoom: 'Area Zoom',
                            back: 'Area Zoom Restore'
                        },
                        yAxisIndex: 'none'
                    },
                    magicType: {
                        title: {'bar': 'Switch To Histogram'},
                        type: ['bar']
                    },
                    restore: {title: 'Reset'},
                    saveAsImage: {title: 'Save As Image'}
                }
            },
            xAxis: {
                type: 'category',
                boundaryGap: false,
                data: []
            },
            yAxis: {
                type: 'value',
                splitNumber: 15

            },

            series: []

        };

        $(document).ready(function () {

            var resultDataTable = null;

            $.ajax({
                type: 'GET',
                url: '/report/daily_summary_data',
                dataType: "json",

                success: function (result) {

                    ////////////////////

                    if (resultDataTable !== null) {
                        resultDataTable.destroy();
                        $('#result-table').empty();
                    }

                    $.extend($.fn.dataTable.defaults, {
                        "dom": '<"table-button"B><"table-filter"f><"table-length"l>'
                    });

                    reusltDataTable = $("#result-table").DataTable({
                        retrieve: true,
                        searching: true,
                        'buttons': [
                            'copy', 'csv', 'excel', 'pdf'
                        ],
                        data: result.tables_result.tables_data,
                        columns: result.tables_result.tables_title,
                        iDisplayLength: 100,
                        "order": [[ 0, "desc" ]],
                        lengthChange: false

                    });
                    ////////////////////

                    for (var c = 0; c < result.charts_result.charts_legend.length; c++) {
                        option.series.push({
                            name: result.charts_result.charts_legend[c],
                            type: 'line',
                            smooth: true,
                            data: []
                        });
                    }


                    var data;
                    for (var d = 0; d < result.charts_result.charts_data.length; d++) {
                        data = result.charts_result.charts_data[d];
                        option.series[d]['data'] = data;

                    }

                    option.xAxis.data = result.charts_result.charts_labels;
                    option.legend.data = result.charts_result.charts_legend;

                    myChart.setOption(option, true);
                }
            })
            ;
        })
        ;
    </script>
{% endblock %}