{% extends "layout/app.html" %}
{% block page_title %}New User{% endblock %}
{% block main_content %}
    <section class="content-header">
        <h1>Users Map</h1>
    </section>

    <section class="content">
        <div class="row">
            <div class="col-md-12">
                <div class="box box-primary">
                    <div class="box-body" style="height:790px">
                        <div class="col-md-2" style="float:right">
                            <div class="form-group">
                                <select class="form-control select2" style="width: 100%;" id="executive-group-type">
                                    <option selected="selected">Daily</option>
                                    <option>Monthly</option>
                                </select>
                            </div>
                        </div>
                        <div id="container-America" style="height: 690px; width: 100%;">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <div class="box box-primary">
                    <div class="box-body" style="height:690px">
                        <div class="col-md-2" style="float:right">
                            <div class="form-group">
                                <select class="form-control select2" style="width: 100%;" id="executive-group-type">
                                    <option selected="selected">Daily</option>
                                    <option>Monthly</option>
                                </select>
                            </div>
                        </div>
                        <div id="container-world" style="height: 600px; width: 100%;">
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </section>
{% endblock %}
{% block body_tail %}



    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/echarts/3.5.4/echarts.min.js"></script>
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/echarts/3.5.2/extension/dataTool.min.js"></script>

    {% assets "flask_AmericaGeojson_js" %}
        <script src="{{ ASSET_URL }}" type="text/javascript"></script>
    {% endassets %}

    {% assets "flask_WorldGeojson_js" %}
        <script src="{{ ASSET_URL }}" type="text/javascript"></script>
    {% endassets %}

    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/echarts/3.5.4/extension/bmap.min.js"></script>

    <script>


        {#        var dom1 = document.getElementById("container-world");#}
        var dom2 = document.getElementById("container-America");

        {#        var myChart_world = echarts.init(dom1);#}
        var myChart_America = echarts.init(dom2);


        var option_America = {
            baseOption: {
                timeline: {
                    axisType: 'category',
                    bottom: -5,
                    playInterval: 1000,
                    data: []
                },
                title: {
                    text: 'World Users Map',
                    left: 'right'
                },
                tooltip: {
                    trigger: 'item',
                    formatter: function (params) {
                        var value = (params.value + '').split('.');
                        value = value[0].replace(/(\d{1,3})(?=(?:\d{3})+(?!\d))/g, '$1,')
                            + '.' + value[1];
                        return params.seriesName + '<br/>' + params.name + ' : ' + value;
                    }
                },
                toolbox: {

                    show: true,
                    orient: 'vertical',
                    left: 'right',
                    top: '68%',
                    feature: {
                        mark: {show: true},
                        restore: {title: 'Reset'}
                    }
                },
                grid: {
                    left: '4%',
                    right: '75%',
                    bottom: '35%',
                    top: '85%'
                },
                xAxis: [{
                    position: 'top',
                    type: 'value',
                    boundaryGap: false,
                    splitLine: {
                        show: false
                    },
                    axisLine: {
                        show: false
                    },
                    axisTick: {
                        show: false
                    },
                }],

                yAxis: {},

                series: [{
                    name: 'World User Map', type: 'map', mapType: 'USA',
                    roam: true,
                    itemStyle: {
                        emphasis: {label: {show: true}}
                    },

                    data: []

                },

                    {

                        z: 2,
                        type: 'bar', label: {
                        normal: {show: true},
                        emphasis: {
                            show: true
                        }
                    },
                        itemStyle: {
                            emphasis: {
                                color: "rgb(254,153,78)"
                            }
                        },

                        data: []


                    }]
            }, options: []
        };
        {#        #}
        {#        var option_world = {#}
        {#            baseOption: {#}
        {#                timeline: {#}
        {#                    axisType: 'category',#}
        {#                    playInterval: 1250,#}
        {#                    data: ['1', '2']#}
        {#                },#}
        {#                title: {text: 'World Users Map', left: 'right'},#}
        {#                tooltip: {#}
        {#                    trigger: 'item', formatter: function (params) {#}
        {#                        var value = (params.value + '').split('.');#}
        {#                        value = value[0].replace(/(\d{1,3})(?=(?:\d{3})+(?!\d))/g, '$1,')#}
        {#                            + '.' + value[1];#}
        {#                        return params.seriesName + '<br/>' + params.name + ' : ' + value;#}
        {#                    }#}
        {#                },#}
        {#                toolbox: {#}
        {##}
        {#                    show: true,#}
        {#                    orient: 'vertical',#}
        {#                    left: 'right',#}
        {#                    top: '68%',#}
        {#                    feature: {#}
        {#                        mark: {show: true},#}
        {#                        restore: {title: 'Reset'}#}
        {#                    }#}
        {#                },#}
        {#                grid: {#}
        {#                    left: '4%',#}
        {#                    right: '75%',#}
        {#                    bottom: '35%',#}
        {#                    top: '85%'#}
        {#                },#}
        {#                xAxis: [{#}
        {#                    position: 'top',#}
        {#                    type: 'value',#}
        {#                    boundaryGap: false,#}
        {#                    splitLine: {#}
        {#                        show: false#}
        {#                    },#}
        {#                    axisLine: {#}
        {#                        show: false#}
        {#                    },#}
        {#                    axisTick: {#}
        {#                        show: false#}
        {#                    }#}
        {#                }],#}
        {##}
        {#                yAxis: {},#}
        {##}
        {#                series: [{#}
        {#                    name: 'World User Map', type: 'map', mapType: 'world',#}
        {#                    roam: true,#}
        {#                    itemStyle: {#}
        {#                        emphasis: {label: {show: true}}#}
        {#                    },#}
        {#                    data: []#}
        {##}
        {#                },#}
        {#                    {#}
        {#                        z: 2,#}
        {#                        type: 'bar', label: {#}
        {#                        normal: {show: true},#}
        {#                        emphasis: {#}
        {#                            show: true#}
        {#                        }#}
        {#                    }, itemStyle: {#}
        {#                        emphasis: {#}
        {#                            color: "rgb(254,153,78)"#}
        {#                        }#}
        {#                    },#}
        {#                        data: []#}
        {#                    }]#}
        {#            },#}
        {#            options: []#}
        {#        };#}
        {##}

        $(document).ready(function () {

            $(".select2").select2();

            $.ajax({
                type: 'GET',
                url: '/report/reg_user_state',
                data: {
                    group: 'Daily'
                },
                dataType: "json",
                success: function (result) {

                    var time_range = result.time_range;

                    option_America.baseOption.data = time_range;


                    for (var index in time_range) {

                        var time = time_range[index];

                        option_America.options.push(
                            {
                                yAxis: {
                                    type: 'category',
                                    data: result.bar_result[index][time].location

                                },
                                title: {text: time + '  World Users Map'},
                                visualMap: {
                                    type: 'continuous',
                                    min: 0,
                                    max: result.bar_result[index][time].reg_count[0],
                                    text: ['High', 'Low'],
                                    left: 'right',
                                    top: 'center',
                                    realtime: false,
                                    calculable: true,
                                    inRange: {color: ['#313695', '#4575b4', '#74add1', '#abd9e9', '#e0f3f8', '#ffffbf', '#fee090', '#fdae61', '#f46d43', '#d73027', '#a50026']}
                                },
                                series: [{data: result.map_result[index]}, {data: result.bar_result[index][time].reg_count}]
                            })
                    }
                }
            })

        });


        {#        myChart_world.setOption(option_world, true);#}

        myChart_America.setOption(option_America, true);


    </script>
{% endblock %}




